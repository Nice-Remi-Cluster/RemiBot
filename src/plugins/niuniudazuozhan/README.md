# 牛牛大作战插件

一个基于 NoneBot2 的有趣群聊互动游戏插件，支持中英文命令。

## 功能特性

- 🎮 **多样化操作**：支持导操作、日群友等互动功能
- 🌐 **双语支持**：同时支持中文快捷命令和英文标准命令
- 🔒 **群聊专用**：仅在群聊中使用，保护用户隐私
- 📊 **数据独立**：每个群的数据完全独立存储
- ⏰ **冷却机制**：防止刷屏，合理控制使用频率
- 🛡️ **防刷保护**：每日被指定次数限制，避免恶意骚扰
- 💥 **暴击系统**：随机暴击效果，增加游戏趣味性
- 📊 **数据统计**：记录操作次数和历史数据

## 安装要求

### 依赖插件

- `nonebot_plugin_orm`: 数据库 ORM 支持
- `nonebot_plugin_alconna`: 命令解析支持

### 安装依赖

```bash
nb plugin install nonebot_plugin_orm
nb plugin install nonebot_plugin_alconna
```

## 使用说明

### 基础命令

| 命令 | 中文快捷方式 | 说明 |
|------|-------------|------|
| `/nndzz dao` | `导` | 对自己进行导操作 |
| `/nndzz view` | `查看牛牛` | 查看自己的牛牛数据 |
| `/nndzz help` | `牛牛帮助` | 显示帮助信息 |

### 互动命令

| 命令 | 中文快捷方式 | 说明 |
|------|-------------|------|
| `/nndzz attack @某人` | `日群友 @某人` | 攻击指定群友 |
| `/nndzz rank` | `牛牛排行榜` | 查看群内排行榜 |

### 管理命令（仅管理员）

| 命令 | 中文快捷方式 | 说明 |
|------|-------------|------|
| `/nndzz reset` | `重置牛牛` | 重置自己的数据 |
| `/nndzz reset @某人` | - | 重置指定用户的数据 |

## 游戏规则

### 基础设定

- **初始长度**：10.00cm
- **长度范围**：-50.00cm ~ 100.00cm
- **暴击概率**：10%
- **暴击倍数**：1.5倍

### 冷却时间

- **导操作**：30分钟
- **日群友**：60分钟
- **查看操作**：5分钟

### 限制机制

- **每日被指定限制**：每人每天最多被日10次
- **群聊限制**：仅在群聊中可用
- **权限控制**：重置功能仅限管理员使用

## 数据说明

- **长度范围**：-50.00cm ~ 100.00cm
- **长度显示**：正数显示为长度（如：15.50cm），负数显示为深度（如：5.20cm深度）
- **数据统计**：记录总操作次数和最后操作时间

## 数据库结构

插件使用以下数据表：

### UserNiuniuData（用户牛牛数据）
- `id`: 主键
- `user_id`: 用户ID
- `group_id`: 群组ID
- `length`: 当前长度
- `total_operations`: 总操作次数
- `created_at`: 创建时间
- `updated_at`: 更新时间

### NiuniuOperation（操作记录）
- `id`: 主键
- `user_id`: 操作用户ID
- `group_id`: 群组ID
- `operation_type`: 操作类型
- `length_change`: 长度变化
- `target_user_id`: 目标用户ID（可选）
- `target_length_change`: 目标长度变化（可选）
- `created_at`: 操作时间

### NiuniuCooldown（冷却时间）
- `id`: 主键
- `user_id`: 用户ID
- `group_id`: 群组ID
- `operation_type`: 操作类型
- `last_used`: 最后使用时间
- `daily_targeted_count`: 每日被指定次数
- `last_targeted_date`: 最后被指定日期

## 开发说明

### 项目结构

```
niuniudazuozhan/
├── __init__.py          # 插件入口
├── config.py            # 配置文件
├── README.md            # 说明文档
├── commands/            # 命令处理模块
│   ├── __init__.py
│   ├── basic.py         # 基础命令
│   └── interactive.py   # 互动命令
├── models/              # 数据模型
│   ├── __init__.py
│   └── user_data.py     # 用户数据模型
├── services/            # 业务逻辑服务
│   ├── __init__.py
│   ├── database.py      # 数据库服务
│   ├── game_logic.py    # 游戏逻辑
│   └── cooldown.py      # 冷却时间管理
└── utils/               # 工具函数
    ├── __init__.py
    ├── random_gen.py    # 随机数生成
    └── validators.py    # 数据验证
```

### 扩展开发

1. **添加新命令**：在 `commands/` 目录下创建新的命令文件
2. **修改游戏逻辑**：编辑 `services/game_logic.py`
3. **调整配置**：修改 `config.py` 中的相关参数
4. **添加新功能**：在相应模块中添加新的方法和类

## 注意事项

1. **数据安全**：插件会记录用户操作，请确保符合隐私政策
2. **性能考虑**：大量用户使用时注意数据库性能优化
3. **权限管理**：管理员功能需要正确配置机器人权限
4. **版本兼容**：确保 NoneBot2 和依赖插件版本兼容

## 更新日志

### v1.0.0
- 初始版本发布
- 支持基础导操作和日群友功能
- 实现冷却时间和防刷机制
- 添加暴击系统和等级描述
- 支持中英文双语命令

## 许可证

本项目采用 MIT 许可证，详见 LICENSE 文件。

## 贡献

欢迎提交 Issue 和 Pull Request 来改进这个插件！

## 联系方式

如有问题或建议，请通过以下方式联系：

- GitHub Issues: [项目地址]
- QQ群: [群号]
- 邮箱: [邮箱地址]